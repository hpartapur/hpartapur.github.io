<!DOCTYPE html>
<!-- TODO: Make leaderboard entries rows -->
<!-- TODO: Figure out how to set a timer -->
<!-- bg, ratios-keyboard  -->
<!-- put profile between rank and name -->
<html>
  <head>
    <meta name="google-adsense-account" content="ca-pub-7620239072665997">
    <meta charset="UTF-8">
    <title>Khardal Typist</title>
    <link rel="stylesheet" href = "type/style.css">
    <link rel="icon" href="podium.png" type="image/png">
    <!-- <script src="sketch.js" type="text/javascript"></script> -->
    <!-- Add Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Audiowide"> -->
  </head>

  <body>
    <script type="module">
        var namedata=[
    {
        "TRNO": "28479",
        "Name": "Burhanu"
    },
    {
        "TRNO": "25857",
        "Name": "Mu"
    }
]

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-analytics.js";
import {
	getDatabase,
	ref,
	push,
	onValue,
	set,
	get,
	update,
} from "https://www.gstatic.com/firebasejs/10.6.0/firebase-database.js";
const firebaseConfig = {
	apiKey: "AIzaSyCooPWsrh3yFb4eat6dg2_VFAIIPF_ET50",
	authDomain: "khardal.firebaseapp.com",
	projectId: "khardal",
	storageBucket: "khardal.appspot.com",
	messagingSenderId: "258618544710",
	appId: "1:258618544710:web:2b734571b863de60dc3047",
};
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      window.database = getDatabase(app);

      function pullData() {
  const dbRef = ref(database);
  onValue(dbRef, (snapshot) => { 
    const data = snapshot.val()['rabt'];
    console.log(data)
    window.data = data;
    var scores=[]
    for (let d in data){
            if (d != "sessions"){
                scores.push([d, data[d]])
            }
        }
        scores.sort(function(a, b) {
            return b[1] - a[1];
        });
                var scoresname = []
                for (let s in scores){
                    for (let name in namedata){
                        if (namedata[name]['TRNO']==scores[s][0]){
                            scoresname.push([namedata[name]['Name'],scores[s][1]])
                        }
                    }
                // for (let name in namedata){
                //     console.log(namedata[name]['TRNO'])
                // }
                }
                console.log(scoresname)
        scores=scoresname



    //TODO: change so that name is 
    // Convert the data object to an array of objects
    // const dataArray = Object.entries(data['users']).map(([name, values]) => ({ name, highscore: values.highscore }));
    const leaderboard = document.getElementById('leaderboard');
    leaderboard.innerHTML = '';

    // Create a table element with Bootstrap classes
    const table = document.createElement('table');
    table.classList.add('table', 'table-striped', 'table-hover', 'table-primary');

    // Create the table header row
    const thead = document.createElement('thead');
    thead.classList.add('thead-dark');
    const headerRow = document.createElement('tr');
    const headers = ['Ranking', "Name", 'Highscore'];

    headers.forEach(headerText => {
      const th = document.createElement('th');
      th.textContent = headerText;
      headerRow.appendChild(th);
    });

    thead.appendChild(headerRow);
    table.appendChild(thead);

    // Create the table body
    const tbody = document.createElement('tbody');
    tbody.classList.add('text-success');

    // Iterate over the sorted array and add rows to the table body
    console.log(scores)
    for (let score in scores){
        const row = document.createElement('tr');
        const rankingCol = document.createElement('td');
        rankingCol.classList.add('font-weight-bold');
        rankingCol.textContent = parseInt(score)+1;
        if (score === 0) {rankingCol.innerHTML += ' ğŸ†';}
        if (score === 1) {rankingCol.innerHTML += 'ğŸ¥ˆ';}
        if (score === 2) {rankingCol.innerHTML += 'ğŸ¥‰';}
        // const nameCol = document.createElement('td'); nameCol.innerHTML = "<img src='"+photo+"' style='height: 5vh; border-radius: 50% '> "+name;
        const nameCol = document.createElement('td'); nameCol.innerHTML = scores[score][0];
        const highscoreCol = document.createElement('td'); highscoreCol.textContent = scores[score][1];
        
        // Append columns to the row
        row.appendChild(rankingCol);
        row.appendChild(nameCol);
        row.appendChild(highscoreCol);
        // Append the row to the table body
        tbody.appendChild(row);
    }
    table.appendChild(tbody);
    // Append the table to the modal footer
    leaderboard.appendChild(table);
  });
}

pullData()


</script>



<div id="leaderboardmodal" class="modal" style="overflow-y: auto; font-family:Arial, Helvetica, sans-serif; display: block;">
  <div class="modal-content" style="width: 75%;">
    <div class="modal-header">
      <center><h2 style='align-self: center; font-weight:600'>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¹Ø¯Ø¯ - Ù„Ø³Ø§Ù† Ø§Ù„Ø¯Ø¹ÙˆØ©</h2></center>
      <!-- <center><h6 style="align-self: center;">Brought to you by Kawakib Creations</h6></center> -->
      <center><h4 style="align-self: center;"><a href="https://khardal.net/rabt.html">khardal.net/rabt.html</a></h4></center>
    </div>
  <div id="leaderboard" class="modal-body"></div>
</div>
</div>





</body>


</html>
