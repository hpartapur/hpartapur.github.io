<!DOCTYPE html>
<html>
	<head>
		<link rel="preload" as="font" href="../assets/Kanz-al-Marjaan.ttf" type="font/ttf" crossorigin="anonymous" />
		<title>Game Page</title>
		<style>
			@font-face {
				font-family: KM;
				src: url(/assets/Kanz-al-Marjaan.ttf);
			}
			body {
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				height: 100vh;
				margin: 0;
				font-family: KM, Arial, sans-serif;
				background-image: url(./asal_assets/bg-downsized.jpg);
				background-size: 70vw;
			}
			.game-box {
				width: 95%;
				height: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				border: 2px solid black;
				background-color: lightgray;
				font-size: 5vh;
			}

			.button-container {
				display: flex;
				justify-content: space-around;
				width: 90vw;
				margin-top: 20px;
			}

			.button {
				padding: 10px 20px;
				font-size: 18px;
				background-color: lightblue;
				border: none;
				cursor: pointer;
				border-radius: 5vw;
				margin: 0.1vw;
				width: 30vw;
				font-family: Al-Kanz;
				font-size: 25vw;
				/* width: 30%; */
			}
			.button:hover {
				background-color: blue;
				width: 31vw;
			}
		</style>
	</head>

	<body>
		<div class="game-box" style="border-radius: 53vw">
			<span id="word" style="font-size: 16vh">Word</span>
		</div>
		<div class="button-container">
			<button class="button"></button>
			<button class="button"></button>
			<button class="button"></button>
			<button class="button"></button>
		</div>
	</body>
	<script type="module">
		var backgroundaudio = new Audio("/type/gwen.mp3");
		var playing = false;
		var questions = [
			// {
			//     "Word": "ياقوت",
			//     "Photo": "./rabt/yaqut.png"
			// },
			// {
			//     "Word": "خزانه",
			//     "Photo": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT1MOKWfwNAo9UGFqtkKy8Q8sIoZd77iGMSNQ&s"
			// },
			// {
			//     "Word": "گهورو",
			//     "Photo": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRt1JRwTY093KvLhMuKh-HhonWqbyPiuhxQ5Q&s"
			// },
			// {
			//     "Word": "ثثنححوتير",
			//     "Photo": "./rabt/pinchotair.png"
			// },
			{
				Word: "ايكتاليس",
				Photo: "./rabt/numbers/Slide41.JPG",
			},
			{
				Word: "بيتاليس",
				Photo: "./rabt/numbers/Slide42.JPG",
			},
			{
				Word: "تيتاليس",
				Photo: "./rabt/numbers/Slide43.JPG",
			},
			{
				Word: " ححُمباليس",
				Photo: "./rabt/numbers/Slide44.JPG",
			},
			{
				Word: "ثثِستاليس",
				Photo: "./rabt/numbers/Slide45.JPG",
			},
			{
				Word: "ححهيتاليس",
				Photo: "./rabt/numbers/Slide46.JPG",
			},
			{
				Word: "سرتاليس",
				Photo: "./rabt/numbers/Slide47.JPG",
			},
			{
				Word: "ارتاليس",
				Photo: "./rabt/numbers/Slide48.JPG",
			},
			{
				Word: "اوككنثثححاس",
				Photo: "./rabt/numbers/Slide49.JPG",
			},
			{
				Word: "ححوثثن",
				Photo: "./rabt/numbers/Slide54.JPG",
			},
			{
				Word: "ثثنححاون",
				Photo: "./rabt/numbers/Slide55.JPG",
			},
			{
				Word: "ححهثثّن",
				Photo: "./rabt/numbers/Slide56.JPG",
			},
			{
				Word: "ستّاون",
				Photo: "./rabt/numbers/Slide57.JPG",
			},
			{
				Word: "اضضهاون",
				Photo: "./rabt/numbers/Slide58.JPG",
			},
			{
				Word: "اوككنساهضضهـ",
				Photo: "./rabt/numbers/Slide59.JPG",
			},
			{
				Word: "ساهضض",
				Photo: "./rabt/numbers/Slide60.JPG",
			},
			{
				Word: "ايكسضضهـ",
				Photo: "./rabt/numbers/Slide61.JPG",
			},
			{
				Word: "باسضضهـ",
				Photo: "./rabt/numbers/Slide62.JPG",
			},
			{
				Word: "تريسضضهـ",
				Photo: "./rabt/numbers/Slide63.JPG",
			},
			{
				Word: "ححوسضضهـ",
				Photo: "./rabt/numbers/Slide64.JPG",
			},
			{
				Word: "ثثانسضضهـ",
				Photo: "./rabt/numbers/Slide65.JPG",
			},
			{
				Word: "ححهاسضضهـ",
				Photo: "./rabt/numbers/Slide66.JPG",
			},
			{
				Word: "سرسضضهـ",
				Photo: "./rabt/numbers/Slide67.JPG",
			},
			{
				Word: "ارسضضهـ",
				Photo: "./rabt/numbers/Slide68.JPG",
			},
			{
				Word: "اوككنستير",
				Photo: "./rabt/numbers/Slide69.JPG",
			},
			{
				Word: "ستير",
				Photo: "./rabt/numbers/Slide70.JPG",
			},
			{
				Word: "ايكوتير",
				Photo: "./rabt/numbers/Slide71.JPG",
			},
			{
				Word: "بظظتّير",
				Photo: "./rabt/numbers/Slide72.JPG",
			},
			{
				Word: "تيظظوتير",
				Photo: "./rabt/numbers/Slide73.JPG",
			},
			{
				Word: "ححموتير",
				Photo: "./rabt/numbers/Slide74.JPG",
			},
			{
				Word: "ثثنححوتير",
				Photo: "./rabt/numbers/Slide75.JPG",
			},
			{
				Word: "ححهوتير",
				Photo: "./rabt/numbers/Slide76.JPG",
			},
			{
				Word: "ستوتير",
				Photo: "./rabt/numbers/Slide77.JPG",
			},
			{
				Word: "اضضهوتير",
				Photo: "./rabt/numbers/Slide78.JPG",
			},
			{
				Word: "اوككنايسي",
				Photo: "./rabt/numbers/Slide79.JPG",
			},
			{
				Word: "ايسي",
				Photo: "./rabt/numbers/Slide80.JPG",
			},
			{
				Word: "ايكياسي",
				Photo: "./rabt/numbers/Slide81.JPG",
			},
			{
				Word: "بياسي",
				Photo: "./rabt/numbers/Slide82.JPG",
			},
			{
				Word: "تيرياسي",
				Photo: "./rabt/numbers/Slide83.JPG",
			},
			{
				Word: "ححورياسي",
				Photo: "./rabt/numbers/Slide84.JPG",
			},
			{
				Word: "ثثنححياسي",
				Photo: "./rabt/numbers/Slide85.JPG",
			},
			{
				Word: "ححهياسي",
				Photo: "./rabt/numbers/Slide86.JPG",
			},
			{
				Word: "ستياسي",
				Photo: "./rabt/numbers/Slide87.JPG",
			},
			{
				Word: "اضضهياسي",
				Photo: "./rabt/numbers/Slide88.JPG",
			},
			{
				Word: "نيوياسي",
				Photo: "./rabt/numbers/Slide89.JPG",
			},
			{
				Word: "نيوو",
				Photo: "./rabt/numbers/Slide90.JPG",
			},
			{
				Word: "ايكانو",
				Photo: "./rabt/numbers/Slide91.JPG",
			},
			{
				Word: "بانو",
				Photo: "./rabt/numbers/Slide92.JPG",
			},
			{
				Word: "تانو",
				Photo: "./rabt/numbers/Slide93.JPG",
			},
			{
				Word: "ححورانو",
				Photo: "./rabt/numbers/Slide94.JPG",
			},
			{
				Word: "ثثنححانو",
				Photo: "./rabt/numbers/Slide95.JPG",
			},
			{
				Word: "ححهنّو",
				Photo: "./rabt/numbers/Slide96.JPG",
			},
			{
				Word: "ستانو",
				Photo: "./rabt/numbers/Slide97.JPG",
			},
			{
				Word: "اضضهانو",
				Photo: "./rabt/numbers/Slide98.JPG",
			},
			{
				Word: "نوانو",
				Photo: "./rabt/numbers/Slide99.JPG",
			},
		];
		var questioned;
		var options;
		var times = [];
		var wrongs = [];
		var attempts = 0;
		let wrongfx = new Audio("/asal_assets/wrong.mp3");
		let rightfx = new Audio("/asal_assets/points.mp3");
		var tr = prompt("Enter your TR number");
		if (typeof tr == "undefined" || tr == null || tr.length < 3) {
			alert("Invalid TR. Please try again");
			location.reload();
		}

		var starttime = new Date();
		var answered = [];

		import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
		// import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-analytics.js";
		import { getDatabase, ref, push, onValue, set, get, update } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-database.js";

		const firebaseConfig = {
			apiKey: "AIzaSyCooPWsrh3yFb4eat6dg2_VFAIIPF_ET50",
			authDomain: "khardal.firebaseapp.com",
			projectId: "khardal",
			storageBucket: "khardal.appspot.com",
			messagingSenderId: "258618544710",
			appId: "1:258618544710:web:2b734571b863de60dc3047",
		};

		// Initialize Firebase
		const app = initializeApp(firebaseConfig);
		window.database = getDatabase(app);
		const dbRef = ref(database);
		onValue(dbRef, (snapshot) => {
			window.data = snapshot.val();
			console.log(data);
		});

		function newWord() {
			starttime = new Date();
			questioned = questions[Math.floor(Math.random() * questions.length)];
			while (answered.indexOf(questioned["Word"]) !== -1) {
				questioned = questions[Math.floor(Math.random() * questions.length)];
			}
			answered.push(questioned["Word"]);
			console.log(questioned);
			// document.getElementById('word').innerText = questioned['Word'];
			// moved this slower so images are first to load

			options = [];
			options.push(questioned["Photo"]);
			while (options.length < 4) {
				var option = questions[Math.floor(Math.random() * questions.length)]["Photo"];
				if (options.indexOf(option) === -1) {
					options.push(option);
				}
			}
			options.sort(() => Math.random() - 0.5);
			document.querySelectorAll(".button").forEach((button, index) => {
				let number = options[index].slice(20, -4);
				button.innerText = number;
				button.style.width = "25vw";
				button.style.height = "25vw";
			});
			document.getElementById("word").innerText = questioned["Word"];
		}

		newWord();
		document.querySelectorAll(".button").forEach((button, index) => {
			button.addEventListener("click", () => {
				console.log(options[index]);
				console.log(questioned["Photo"]);
				attempts++;
				if (options[index] === questioned["Photo"]) {
					//if selected is correct

					times.push((new Date() - starttime) / 1000);
					newWord();
					var totaltime = 0;
					for (let time in times) {
						totaltime += times[time];
					}
					if (totaltime < 53) {
						newWord();
					} else {
						var avg = times.length / totaltime;
						avg = avg * 60;
						avg = Math.round(avg * 100) / 100;
						console.log(avg + "words per minute");
						var accuracy = 100 - (wrongs.length / attempts) * 100;
						console.log("Accuracy: " + accuracy + "%");
						push(ref(database, "rabt/sessions/"), {
							tr: tr,
							avg: avg,
							timestamp: new Date().toISOString(),
							date: new Date().toDateString(),
							accuracy: accuracy,
							wrongs: wrongs,
						});
						if (!data.rabt[tr] || avg > data.rabt[tr]) {
							set(ref(database, "rabt/" + tr), avg);
						}
						alert("TR: " + tr + "\n" + avg + " words per minute" + "\n" + "Accuracy: " + accuracy + "%");
						var scores = [];
						for (let d in data.rabt) {
							if (d != "sessions") {
								scores.push([d, data.rabt[d]]);
							}
						}
						scores.sort(function (a, b) {
							return b[1] - a[1];
						});
						var scorestring = "";
						for (let s in scores) {
							var rank = parseInt(s) + 1;
							scorestring += rank + ". " + scores[s][0] + ": " + scores[s][1] + "numbers per minute \n";
						}
						alert("Top Scores:\n" + scorestring);
						location.reload();
					}

					rightfx.play();
					if (playing == false) {
						backgroundaudio.play();
						playing = true;
					}
				} else {
					wrongfx.play();
					alert("Wrong");
					answered.pop(questioned["Word"]);
					wrongs.push(questioned["Word"]);
				}
			});
			// button.querySelector("img").src = options[index];
		});
	</script>
</html>
