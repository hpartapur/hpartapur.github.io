<!DOCTYPE html>
<!-- TODO: Figure out how to trigger opening of keyboard on mobile devices -->
<!-- TODO: Figure out how to set a timer -->
<!-- bg, switches, ratios-keyboard  -->
<html>
  <head>
    <meta charset="UTF-8">
    <title>Khardal Typist</title>
    <script src="libraries/p5.min.js" type="text/javascript"></script>
    <script src="libraries/p5.sound.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href = "style.css">
    <!-- <script src="sketch.js" type="text/javascript"></script> -->
    <!-- Add Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZJM8TVT5H6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-ZJM8TVT5H6');
    </script>
  </head>
  <script>
    //detect if mobile screen to open keyboard
    if (window.matchMedia("(max-width: 600px)").matches) {
      prompt()
    }
  </script>
  <body>
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-analytics.js";
      import { getDatabase, ref, push, onValue, set, get } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-database.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyCwcVRnXVs5M8EWEipwRgBREInAMgvj36s",
        authDomain: "khardal-typist.firebaseapp.com",
        databaseURL: "https://khardal-typist-default-rtdb.firebaseio.com",
        projectId: "khardal-typist",
        storageBucket: "khardal-typist.appspot.com",
        messagingSenderId: "277127524840",
        appId: "1:277127524840:web:c94fb2984ae4b694afb45d",
        measurementId: "G-JK8X82LLSX"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);

      window.database = getDatabase(app);



    function writeUserData() {
      set(ref(database, 'users/'+name), {
        highscore: highscore,
        dateJoined: Date()
      });
    }
    function writeSessionData (){
      if (badName()){name="anonymous"}
      push(ref(database, 'sessions/'), {
        name: name,
        score:score,
        datePlayed: Date()
      });      
    }

function updateHighscore() {
  if (badName()){name="anonymous"}
  const userRef = ref(database, 'users/' + name);
  // Use the update function to update the highscore property
  set(userRef, {
    highscore: highscore
  }, { merge: true });
}

window.writeSessionData = writeSessionData;
window.updateHighscore = updateHighscore;

function badName(){
  if (getCookie('name')==undefined || getCookie('name')=='' || getCookie('name')=='null'){
    return true
  }else{return false}
}



function pullData(){
  // read data from firebase database
  const dbRef = ref(database);
  onValue(dbRef, (snapshot) => {
    const data = snapshot.val();
    var zz = Object.values(data)[0]
    zz = Object.values(zz)
    // console.log(Object.values(data['sessions'])[0])
    console.log(Object.entries(data['users']))
    var userdata = Object.entries(data['users'])

    // document.getElementById("Modal Footer").innerHTML= zz[1]['harf'];
  });
}

// pullData()

// function printHighscores() {
//   const usersRef = ref(database, 'users');
//   const snapshot = get(usersRef);


//     const usersData = snapshot.val();

//     // Convert the usersData object to an array of [name, data] pairs
//     const usersArray = Object.entries(usersData);

//     // Map the array to include only the name and highscore properties
//     const resultArray = usersArray.map(([name, data]) => [name, { highscore: data.highscore }]);

//     // Print the resultArray
//     console.log(resultArray);
//   }


// Example of how to call the function
// printHighscores();

// printHighscores()

if (badName()){
  name=prompt("Enter your name \nThis name cannot be changed!")
  document.cookie = "name="+name

  if (badName()==false){
    writeUserData()
  }
}
</script>



<!-- Add the switch right after the "Mode" button -->
<!-- <div class="custom-control custom-switch" style="font-size: 2rem;">
  <input type="checkbox" class="custom-control-input" id="customSwitch1">
  <label class="custom-control-label" for="customSwitch1"></label>
</div> -->

  

  <center id="p5canvas"><div id="canvas-container" style="border:0.1rem solid #000000;"></div></center>

<div id="keyboard">
  <div class="row">
    <button class="key">ذ</button>
    <button class="key">1</button>
    <button class="key">2</button>
    <button class="key">3</button>
    <button class="key">4</button>
    <button class="key">5</button>
    <button class="key">6</button>
    <button class="key">7</button>
    <button class="key">8</button>
    <button class="key">9</button>
    <button class="key">0</button>
    <button class="key">-</button>
    <button class="key">=</button>
    <button class="key">Backspace</button>
  </div>

  <div class="row">
    <button class="key">Tab</button>
    <button class="key">ض</button>
    <button class="key">ص</button>
    <button class="key">ث</button>
    <button class="key">ق</button>
    <button class="key">ف</button>
    <button class="key">غ</button>
    <button class="key">ع</button>
    <button class="key">ه</button>
    <button class="key">خ</button>
    <button class="key">ح</button>
    <button class="key">ج</button>
    <button class="key">د</button>
    <button class="key">\</button>
  </div>

  <div class="row">
    <button class="key">Caps Lock</button>
    <button class="key">ش</button>
    <button class="key">س</button>
    <button class="key">ي</button>
    <button class="key">ب</button>
    <button class="key">ل</button>
    <button class="key">ا</button>
    <button class="key">ت</button>
    <button class="key">ن</button>
    <button class="key">م</button>
    <button class="key">ك</button>
    <button class="key">ط</button>
    <button class="key">Enter</button>
  </div>

  <div class="row">
    <button class="key">Shift</button>
    <button class="key">ئ</button>
    <button class="key">ء</button>
    <button class="key">ؤ</button>
    <button class="key">ر</button>    
    <button class="key">لا</button>
    <button class="key">ى</button>
    <button class="key">ة</button>
    <button class="key">و</button>
    <button class="key">ز</button>
    <button class="key">ظ</button>
    <button class="key">Shift</button>
  </div>
</div>
<div id="settings">
  <button class="key" style="display: inline;" onclick="modal.style.display='block'; console.log(score);">❓</button>
  <button id="pauser" class="key" style="display: inline;" onclick="pauseButton(); keyPressed()"></button>
  <button id="fxmuter" class="key" onclick="fxmuteButton()" style="display: inline;"></button>
  <button id="muter" class="key" onclick="muteButton()" style="display: inline;"></button>
  <button id="keyboarder" class="key" style="position:relative; left: 0;" onclick="document.getElementById('keyboard').hidden = !document.getElementById('keyboard').hidden;"> Keyboard ⌨</button>
  <button class="key" style="display: inline;" id="hinter" onclick="hintsButton()">Hinting On</button>
</div>

<!-- Trigger/Open The Modal -->
<div id="myModal" class="modal">
  <!-- Modal content -->
   <div class="modal-content" style="width: 80%;">
    <div id = "ModalHeaderDiv" class="modal-header">
      <center><h2 style='align-self: center;' id="Modal Header">Type to win!</h2></center>
      <span class="close">&times;</span></div>
    <div class="modal-body">
      <h2 style="text-align: center;">Type the falling Arabic letters!<br>Don't let the keys reach the bottom of the screen!</h2>
      <li>English keyboard can also be used with most keyboard layouts</li>
      <li>Use space to pause and resume</li>
      <li>Users with different keyboard layouts should switch to Arabic keyboard for best results</li>
      <li>This site uses cookies and other methods to collect data to optimize your user experience</li>
      <li>This game is still in development</li>
    </div>
    <div id = "ModalFooterDiv" class="modal-footer">
      <h3 id="Modal Footer">Brought to you by <a style="color: purple;" href="https:kawakibcreations.net" >Kawakib Creations</a></h3>
    </div>
  </div>
</div>
<script src="sketch.js" type="text/javascript"></script>
</body>

        


<script> // Get the modal
  var modal = document.getElementById("myModal");
  // Get the <span> element that closes the modal
  var span = document.getElementsByClassName("close")[0];//close modal when x clicked
  span.onclick = function() {
    modal.style.display = "none";
 //     firsthint()
  }
  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
 //    firsthint()
    }
  }
  modal.style.display="block"
  
  document.addEventListener('keydown', function(event) {
      if (event.keyCode == 32) {
          pauseButton();
      }
  });
  </script>

</html>
