<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Teachable Machine Image Model</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				text-align: center;
				margin: 20px;
			}
			#webcam-container {
				margin: 20px auto;
			}
			button {
				padding: 10px 20px;
				background-color: #007bff;
				color: white;
				border: none;
				border-radius: 5px;
				cursor: pointer;
			}
			button:hover {
				background-color: #0056b3;
			}
			#label-container div {
				margin-top: 10px;
				font-size: 20px;
				font-weight: bold;
			}
			#message-container {
				margin-top: 20px;
				font-size: 16px;
				line-height: 1.5;
				color: #333;
				text-align: left;
				display: inline-block;
				max-width: 600px;
			}
			video {
				border: 1px solid #ccc;
				border-radius: 10px;
			}
		</style>
	</head>
	<body>
		<h1>Teachable Machine Image Model</h1>
		<p>Select a camera to start:</p>
		<button type="button" onclick="init('user')">Front Camera</button>
		<button type="button" onclick="init('environment')">Back Camera</button>
		<div id="webcam-container">
			<video id="webcam" autoplay playsinline></video>
		</div>
		<div id="label-container"></div>
		<div id="message-container"></div>

		<!-- Include TensorFlow.js -->
		<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
		<!-- Include Teachable Machine Image Library -->
		<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

		<script>
			const URL = "https://teachablemachine.withgoogle.com/models/xz_aS7qUk/";

			let model, video, labelContainer, maxPredictions;

			// Messages for each class
			const classMessages = {
				Sahat: "Sāhat, located south of the masjid, is inspired by courtyards like al-Jāmiʿ al-Azhar and al-Jāmiʿ al-Anwar. The original Aljamea-tus-Saifiyah campus in Surat had an open courtyard, and the Nairobi Jamea follows a hypo-style layout. Its size is 60 x 40 meters.",
				Wajehat:
					"The architectural design is inspired by Jamea Anwar, incorporating protrusions, a distinct feature of Fatimi style architecture. The protrusions in the masjid serve a symbolic purpose, representing the qibla and Imam. The shorofaat, ornamental details known for their aesthetic intricacy, are prominently featured on the wajehat. These elements are influenced by Anwar's architectural traditions, contributing to the visual richness and cultural heritage of the design. The minarets are styled after those of Jame Anwar and feature exquisite Islamic stonework, Arabesque designs, and Kufic inscriptions. Both minarets incorporate Fatimi motifs, based on two rotated squares.",
				"Arches and Grilles":
					"The arches are inspired by the horseshoe arches of Mahdiyya, constructed with two types of stones: yellow stone on the arches' perimeters and Misri-origin stone from the bir. The grills within the arches draw inspiration from the architectural styles of Azhar, constructed using GFRC (glass fiber reinforced concrete).",
				"Persian Char Bagh":
					"Sāhat, located south of the masjid, follows a hypo-style layout similar to courtyards like al-Jāmiʿ al-Azhar and al-Jāmiʿ al-Anwar. The four gardens within the sahat follow a Persian 'baagh' design and symbolize the four rivers (anhaar) of Jannah (paradise). These gardens are named Tasneem, Kafur, Kausar, and Salsabil, in alignment with the concept of the four rivers of Jamea, a tradition established by Aqa Maula.",
				Bir: "This Bir is a direct imitation of the one in Jame Al-Anwar. It contains the barakat of 16 different holy places: 1) Zamzam, 2) Bir e Hakimi, 3) Moulana Abbas Zareeh entrance, 4) Well of Sydna Hatim, 5) Well of Sydna Idris in Shibaam, 6) Well of Sydna Yusuf Najmuddin in Sidhpur, 7) Jubbe Maryam Sydna Hebatullah, 8) Well of Al Jamea Tus Saifiyah Surat, 9) Shifa of Sydna Mufaddal Saifuddin, 10) Well near Pakhti of Syedi Fakhruddin Al Shaheed, 11) Well of Moulaya Raja in Morbi, 12) House of Syedi Hasanji Badshah, 13) House of Syedi AbdulQadir Hakimuddin, 14) Well of Kaka Akela and Kaka Akeli, 15) Well in Mazar of Moulaya Nuruddin, 16) Well of Moulaya Najamkhan.",
				Tiles: "The use of locally sourced stones, including Machakos tiles in the sahat, contributes to eco-friendly architecture by minimizing transportation-related carbon emissions. Additionally, the yellow stone used on the arches' perimeters and the stone of the bir are of Misri origin.",
			};

			async function init(facingMode) {
				try {
					// Stop the previous video stream if it exists
					if (video && video.srcObject) {
						const tracks = video.srcObject.getTracks();
						tracks.forEach((track) => track.stop());
					}

					// Access the webcam with the specified facing mode
					const constraints = {
						video: {
							facingMode: facingMode, // "user" for front, "environment" for back
						},
					};
					const stream = await navigator.mediaDevices.getUserMedia(constraints);

					// Attach the stream to the video element
					video = document.getElementById("webcam");
					video.srcObject = stream;

					// Load the model if not already loaded
					if (!model) {
						const modelURL = URL + "model.json";
						const metadataURL = URL + "metadata.json";
						model = await tmImage.load(modelURL, metadataURL);
						maxPredictions = model.getTotalClasses();
					}

					labelContainer = document.getElementById("label-container");
					labelContainer.innerHTML = ""; // Clear previous labels
					labelContainer.appendChild(document.createElement("div")); // For the top prediction

					// Start prediction loop
					predictLoop();
				} catch (error) {
					console.error("Error accessing webcam:", error);
					alert("Failed to access the camera. Please check your permissions or try again.");
				}
			}

			async function predictLoop() {
				if (!video || !video.srcObject) return;

				const prediction = await model.predict(video);

				// Find the class with the highest confidence
				const topPrediction = prediction.reduce((best, current) => (current.probability > best.probability ? current : best));

				// Display the top prediction
				labelContainer.firstChild.innerHTML = `${topPrediction.className}: ${topPrediction.probability.toFixed(2)}`;

				// Display the corresponding message if available
				const messageContainer = document.getElementById("message-container");
				messageContainer.innerHTML = classMessages[topPrediction.className] || "";

				// Continue the prediction loop
				requestAnimationFrame(predictLoop);
			}
		</script>
	</body>
</html>
